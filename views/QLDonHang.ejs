<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Đơn Hàng - MobileStore Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div class="sidebar-title">MobileStore Pro</div>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">Tổng quan</div>
                    
                    <a href="/TongQuanHeThong" class="menu-item admin-only">
                        <div class="menu-icon">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="menu-text">Dashboard</div>
                    </a>
                </div>
        
                <div class="menu-section">
                    <div class="menu-section-title">Quản lý</div>
                    <a href="/QLSanPham" class="menu-item">
                        <div class="menu-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="menu-text">Sản phẩm</div>
                    </a>
                    
                    <a href="/QLDonHang" class="menu-item">
                        <div class="menu-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="menu-text">Đơn hàng</div>
                    </a>
                    
                    <a href="/QLKhachHang" class="menu-item">
                        <div class="menu-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="menu-text">Khách hàng</div>
                    </a>
                    
                    <a href="/QLNhanVien" class="menu-item admin-only">
                        <div class="menu-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="menu-text">Nhân viên</div>
                    </a>
                </div>
        
                <div class="menu-section">
                    <div class="menu-section-title">Hệ thống</div>
                    
                    <a href="/QLNhaCungCap" class="menu-item admin-only">
                        <div class="menu-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="menu-text">Nhà cung cấp</div>
                    </a>
                    
                    <a href="/QLDangMuc" class="menu-item admin-only">
                        <div class="menu-icon">
                            <i class="fas fa-list"></i>
                        </div>
                        <div class="menu-text">Danh mục</div>
                    </a>
                    
                    <a href="reports.html" class="menu-item admin-only">
                        <div class="menu-icon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="menu-text">Báo cáo</div>
                    </a>
                    
                    <a href="settings.html" class="menu-item admin-only">
                        <div class="menu-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <div class="menu-text">Cài đặt</div> </a>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="admin-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="admin-info">
                    <div class="admin-name" id="current-username">User</div>
                    <div class="admin-role" id="current-role-name">Thành viên</div>
                </div>
                <div class="logout-btn" onclick="logout()" style="cursor: pointer; margin-left: 10px;">
                     <i class="fas fa-sign-out-alt"></i>
                </div>
            </div>
            
            <div class="toggle-sidebar">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <div class="header-title">Quản Lý Đơn Hàng</div>
                    <div class="breadcrumb">
                        <div class="breadcrumb-item">
                            <i class="fas fa-home"></i>
                            <a href="index.html">Trang chủ</a>
                        </div>
                        <div class="breadcrumb-item active">Đơn hàng</div>
                    </div>
                </div>

                <div class="header-right">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="orderSearch" placeholder="Tìm kiếm đơn hàng...">
                    </div>

                    <div class="notifications">
                        <i class="fas fa-bell notification-icon"></i>
                        <span class="notification-count">3</span>
                        <div class="notification-dropdown">
                            <div class="notification-header">
                                <div class="notification-title">Thông báo</div>
                                <div class="notification-clear">Đánh dấu đã đọc tất cả</div>
                            </div>
                            <div class="notification-list">
                                <!-- Notifications will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <div class="user-menu">
                        <div class="user-info">
                            <div class="admin-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <div class="user-name">Nguyen Van An</div>
                                <div class="user-role">Quản lý</div>
                            </div>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="user-dropdown">
                            <div class="user-dropdown-item">
                                <i class="fas fa-user"></i>
                                <span>Hồ sơ cá nhân</span>
                            </div>
                            <div class="user-dropdown-item">
                                <i class="fas fa-cog"></i>
                                <span>Cài đặt tài khoản</span>
                            </div>
                            <div class="user-dropdown-divider"></div>
                            <div class="user-dropdown-item logout-btn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Đăng xuất</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <div class="content">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <div class="page-title">Quản Lý Đơn Hàng</div>
                        <div class="page-subtitle">Theo dõi và xử lý tất cả đơn hàng của cửa hàng</div>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-outline" onclick="exportToExcel()">
                            <i class="fas fa-file-export"></i> Xuất Excel
                        </button>
                        <button class="btn btn-primary" onclick="openModal('createOrderModal')">
                            <i class="fas fa-plus"></i> Tạo đơn hàng
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #4361ee, #4cc9f0);">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statTotalOrders">10</h3>
                            <p>Tổng đơn hàng</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #7209b7, #f72585);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statPendingOrders">1</h3>
                            <p>Đang chờ xử lý</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #ff9e00, #ffd166);">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statShippingOrders">2</h3>
                            <p>Đang giao hàng</p>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #06d6a0, #118ab2);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="statCompletedOrders">6</h3>
                            <p>Đã hoàn thành</p>
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <div class="table-container">
                    <div class="table-header">
                        <div class="table-title">Danh sách đơn hàng</div>
                        <div class="table-actions">
                            <div class="table-filters">
                                <select class="filter-select" id="orderStatusFilter">
                                    <option value="">Tất cả trạng thái</option>
                                    <option value="ChoXuLy">Chờ xử lý</option>

                                    <option value="HoanThanh">Hoàn thành</option>
                                    <option value="DaHuy">Đã hủy</option>
                                </select>
                                <select class="filter-select" id="paymentFilter">
                                    <option value="">Tất cả hình thức TT</option>
                                    <option value="TienMat">Tiền mặt</option>
                                    <option value="ChuyenKhoan">Chuyển khoản</option>
                                    <option value="The">Thẻ</option>
                                </select>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="resetFilters()">
                                <i class="fas fa-redo"></i> Đặt lại
                            </button>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table id="ordersTable">
                            <thead>
                                <tr>
                                    <th>Mã HD</th>
                                    <th>Khách hàng</th>
                                    <th>Ngày đặt</th>

                                    <th>Tổng tiền</th>
                                    <th>Thanh toán</th>
                                    <th>Trạng thái</th>
                                    <th>Ghi chú</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr data-order='{"MaHD":"HD001","MaKH":"KH001","TenKH":"Nguyen Van Khach","SoDienThoai":"0990000001","DiaChi":"Go Vap, HCM","NgayDat":"2024-04-01","SanPham":"iPhone 15 Pro Max 256GB","SoLuong":1,"TongTien":34990000,"HinhThucTT":"banking","TrangThai":"completed","NhanVien":"NV002"}'>
                                    <td><strong>HD001</strong></td>
                                    <td>
                                        <div class="customer-name">
                                            Nguyen Van Khach
                                            <div class="customer-phone">0990000001</div>
                                        </div>
                                    </td>
                                    <td>01/04/2024</td>
                                    <td>iPhone 15 Pro Max 256GB × 1</td>
                                    <td><strong>34,990,000 ₫</strong></td>
                                    <td>
                                        <span class="payment banking">Chuyển khoản</span>
                                    </td>
                                    <td>
                                        <span class="status completed">Hoàn thành</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="Xem chi tiết" onclick="viewOrderDetail('HD001')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit-btn" title="Cập nhật trạng thái" onclick="updateOrderStatus('HD001')">
                                                <i class="fas fa-sync"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="Xóa" onclick="deleteOrder('HD001')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-order='{"MaHD":"HD002","MaKH":"KH002","TenKH":"Tran Thi Mua","SoDienThoai":"0990000002","DiaChi":"Tan Binh, HCM","NgayDat":"2024-04-01","SanPham":"iPhone 14 Plus 128GB","SoLuong":1,"TongTien":21990000,"HinhThucTT":"cash","TrangThai":"completed","NhanVien":"NV002"}'>
                                    <td><strong>HD002</strong></td>
                                    <td>
                                        <div class="customer-name">
                                            Tran Thi Mua
                                            <div class="customer-phone">0990000002</div>
                                        </div>
                                    </td>
                                    <td>01/04/2024</td>
                                    <td>iPhone 14 Plus 128GB × 1</td>
                                    <td><strong>21,990,000 ₫</strong></td>
                                    <td>
                                        <span class="payment cash">Tiền mặt</span>
                                    </td>
                                    <td>
                                        <span class="status completed">Hoàn thành</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="Xem chi tiết" onclick="viewOrderDetail('HD002')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit-btn" title="Cập nhật trạng thái" onclick="updateOrderStatus('HD002')">
                                                <i class="fas fa-sync"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="Xóa" onclick="deleteOrder('HD002')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-order='{"MaHD":"HD003","MaKH":"KH003","TenKH":"Le Van Sam","SoDienThoai":"0990000003","DiaChi":"Quan 3, HCM","NgayDat":"2024-04-02","SanPham":"Samsung Galaxy S24 Ultra","SoLuong":1,"TongTien":32020000,"HinhThucTT":"card","TrangThai":"completed","NhanVien":"NV004"}'>
                                    <td><strong>HD003</strong></td>
                                    <td>
                                        <div class="customer-name">
                                            Le Van Sam
                                            <div class="customer-phone">0990000003</div>
                                        </div>
                                    </td>
                                    <td>02/04/2024</td>
                                    <td>Samsung Galaxy S24 Ultra × 1</td>
                                    <td><strong>32,020,000 ₫</strong></td>
                                    <td>
                                        <span class="payment card">Thẻ</span>
                                    </td>
                                    <td>
                                        <span class="status completed">Hoàn thành</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="Xem chi tiết" onclick="viewOrderDetail('HD003')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit-btn" title="Cập nhật trạng thái" onclick="updateOrderStatus('HD003')">
                                                <i class="fas fa-sync"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="Xóa" onclick="deleteOrder('HD003')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-order='{"MaHD":"HD004","MaKH":"KH004","TenKH":"Pham Thi Tieu","SoDienThoai":"0990000004","DiaChi":"Quan 1, HCM","NgayDat":"2024-04-02","SanPham":"Samsung Galaxy A54 5G","SoLuong":1,"TongTien":8520000,"HinhThucTT":"banking","TrangThai":"pending","NhanVien":"NV004"}'>
                                    <td><strong>HD004</strong></td>
                                    <td>
                                        <div class="customer-name">
                                            Pham Thi Tieu
                                            <div class="customer-phone">0990000004</div>
                                        </div>
                                    </td>
                                    <td>02/04/2024</td>
                                    <td>Samsung Galaxy A54 5G × 1</td>
                                    <td><strong>8,520,000 ₫</strong></td>
                                    <td>
                                        <span class="payment banking">Chuyển khoản</span>
                                    </td>
                                    <td>
                                        <span class="status pending">Chờ xử lý</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="Xem chi tiết" onclick="viewOrderDetail('HD004')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit-btn" title="Cập nhật trạng thái" onclick="updateOrderStatus('HD004')">
                                                <i class="fas fa-sync"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="Xóa" onclick="deleteOrder('HD004')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-order='{"MaHD":"HD005","MaKH":"KH005","TenKH":"Hoang Van Dung","SoDienThoai":"0990000005","DiaChi":"Binh Thanh, HCM","NgayDat":"2024-04-03","SanPham":"Xiaomi 14 12GB/256GB","SoLuong":1,"TongTien":22490000,"HinhThucTT":"cash","TrangThai":"shipping","NhanVien":"NV002"}'>
                                    <td><strong>HD005</strong></td>
                                    <td>
                                        <div class="customer-name">
                                            Hoang Van Dung
                                            <div class="customer-phone">0990000005</div>
                                        </div>
                                    </td>
                                    <td>03/04/2024</td>
                                    <td>Xiaomi 14 12GB/256GB × 1</td>
                                    <td><strong>22,490,000 ₫</strong></td>
                                    <td>
                                        <span class="payment cash">Tiền mặt</span>
                                    </td>
                                    <td>
                                        <span class="status shipping">Đang giao hàng</span>
                                    </td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view-btn" title="Xem chi tiết" onclick="viewOrderDetail('HD005')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit-btn" title="Cập nhật trạng thái" onclick="updateOrderStatus('HD005')">
                                                <i class="fas fa-sync"></i>
                                            </button>
                                            <button class="action-btn delete-btn" title="Xóa" onclick="deleteOrder('HD005')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr> 
                            </tbody>
                        </table>
                        <div class="pagination-container" id="pagination"></div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="widgets-container">
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-title">Thống kê đơn hàng hôm nay</div>
                        </div>
                        <div class="widget-content">
                            <div class="order-stats">
                                <div class="order-stat-item">
                                    <div class="stat-value">3</div>
                                    <div class="stat-label">Đơn mới</div>
                                </div>
                                <div class="order-stat-item">
                                    <div class="stat-value">2</div>
                                    <div class="stat-label">Đang giao</div>
                                </div>
                                <div class="order-stat-item">
                                    <div class="stat-value">89.5 tr</div>
                                    <div class="stat-label">Doanh thu</div>
                                </div>
                                <div class="order-stat-item">
                                    <div class="stat-value">18.2 tr</div>
                                    <div class="stat-label">Lợi nhuận</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-title">Đơn hàng cần xử lý gấp</div>
                            <button class="btn btn-sm btn-warning" onclick="processAllPendingOrders()">
                                <i class="fas fa-play"></i> Xử lý tất cả
                            </button>
                        </div>
                        <div class="widget-content">
                            <div class="urgent-orders">
                                <div class="urgent-order-item">
                                    <div class="urgent-order-header">
                                        <div class="order-id">HD004</div>
                                        <div class="order-time">14:15</div>
                                    </div>
                                    <div class="urgent-order-body">
                                        <div class="customer">Pham Thi Tieu</div>
                                        <div class="amount">8,520,000 ₫</div>
                                    </div>
                                    <div class="urgent-order-actions">
                                        <button class="btn btn-sm btn-success" onclick="processOrder('HD004')">
                                            <i class="fas fa-check"></i> Xử lý
                                        </button>
                                        <button class="btn btn-sm btn-outline" onclick="viewOrderDetail('HD004')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="urgent-order-item">
                                    <div class="urgent-order-header">
                                        <div class="order-id">HD008</div>
                                        <div class="order-time">11:00</div>
                                    </div>
                                    <div class="urgent-order-body">
                                        <div class="customer">Vu Thi Gop</div>
                                        <div class="amount">8,940,000 ₫</div>
                                    </div>
                                    <div class="urgent-order-actions">
                                        <button class="btn btn-sm btn-success" onclick="processOrder('HD008')">
                                            <i class="fas fa-check"></i> Xử lý
                                        </button>
                                        <button class="btn btn-sm btn-outline" onclick="viewOrderDetail('HD008')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <footer class="footer">
                <div>
                    &copy; 2024 MobileStore Pro. Phiên bản 2.0.0
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link">Trợ giúp</a>
                    <a href="#" class="footer-link">Điều khoản</a>
                    <a href="#" class="footer-link">Bảo mật</a>
                </div>
            </footer>
        </div>
    </div>

    <!-- Modal: Tạo đơn hàng -->
    <div class="modal" id="createOrderModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Tạo đơn hàng mới</div>
                <button class="close-modal" onclick="closeModal('createOrderModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createOrderForm">
                    <div class="form-section">
                        <div class="form-section-title">
                            <i class="fas fa-user"></i> Thông tin khách hàng
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">Khách hàng</label>
                                <select class="form-control form-select" name="customer" required>
                                    <option value="">Chọn khách hàng</option>

                                    <option value="new">+ Thêm khách hàng mới</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Số điện thoại</label>
                                <input type="text" class="form-control" name="phone" placeholder="Số điện thoại">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Địa chỉ giao hàng</label>
                            <textarea class="form-control" name="address" rows="2"
                                placeholder="Địa chỉ giao hàng"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">
                            <i class="fas fa-shopping-cart"></i> Sản phẩm đặt hàng
                        </div>
                        <div class="order-products">
                            <div class="product-search mb-3">
                                <input type="text" class="form-control" id="productSearchInput"
                                    placeholder="Tìm kiếm sản phẩm...">
                                <div class="search-results" id="productSearchResults"></div>
                            </div>

                            <div class="table-responsive">
                                <table class="order-items-table">
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>Sản phẩm</th>
                                            <th>Đơn giá</th>
                                            <th>Số lượng</th>
                                            <th>Thành tiền</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody id="orderItemsTable">
                                        <!-- Order items will be added here -->
                                    </tbody>
                                    <tfoot>
                                        <tr>
                                            <td colspan="4" class="text-end"><strong>Tổng cộng:</strong></td>
                                            <td id="orderTotal">0 ₫</td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-section-title">
                            <i class="fas fa-cog"></i> Thông tin bổ sung
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label required">Hình thức thanh toán</label>
                                <select class="form-control form-select" name="paymentMethod" required>
                                    <option value="TienMat">Tiền mặt</option>
                                    <option value="ChuyenKhoan">Chuyển khoản</option>
                                    <option value="The">Thẻ</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phí vận chuyển</label>
                                <input type="number" class="form-control" name="shippingFee"
                                    placeholder="Phí vận chuyển" value="0" min="0">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Giảm giá</label>
                                <input type="number" class="form-control" name="discount" placeholder="Giảm giá"
                                    value="0" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nhân viên bán hàng</label>
                                <select class="form-control form-select" name="employee">
                                    <option value="">Chọn nhân viên</option>
                                    <!-- <option value="NV002">NV002 - Tran Thi Binh</option>
                                    <option value="NV004">NV004 - Pham Thi Dung</option>
                                    <option value="NV008">NV008 - Vu Thi Hoa</option> -->
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ghi chú đơn hàng</label>
                            <textarea class="form-control" name="orderNote" rows="2"
                                placeholder="Ghi chú về đơn hàng..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" onclick="createOrder()">
                            <i class="fas fa-check"></i> Tạo đơn hàng
                        </button>
                        <button type="button" class="btn" onclick="closeModal('createOrderModal')">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal: Chi tiết đơn hàng -->
    <div class="modal" id="orderDetailModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Chi tiết đơn hàng</div>
                <button class="close-modal" onclick="closeModal('orderDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="orderDetailContent">
                    <!-- Order details will be loaded here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="updateStatusCurrentOrder()">
                    <i class="fas fa-sync"></i> Cập nhật trạng thái
                </button>
                <button type="button" class="btn" onclick="closeModal('orderDetailModal')">Đóng</button>
            </div>
        </div>
    </div>

    <!-- Modal: Cập nhật trạng thái -->
    <div class="modal" id="updateStatusModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Cập nhật trạng thái đơn hàng</div>
                <button class="close-modal" onclick="closeModal('updateStatusModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="updateStatusForm">
                    <input type="hidden" id="updateOrderId">

                    <div class="form-group">
                        <label class="form-label required">Trạng thái mới</label>
                        <select class="form-control form-select" id="newStatus" required>
                            <option value="">Chọn trạng thái</option>
                            <option value="ChoXuLy">Chờ xử lý</option>
                            
                            <option value="HoanThanh">Hoàn thành</option>
                            <option value="DaHuy">Đã hủy</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ghi chú cập nhật</label>
                        <textarea class="form-control" id="statusNote" rows="3"
                            placeholder="Ghi chú về việc cập nhật trạng thái..."></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" onclick="saveOrderStatus()">
                            <i class="fas fa-save"></i> Cập nhật
                        </button>
                        <button type="button" class="btn" onclick="closeModal('updateStatusModal')">Hủy</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/QLDonHang.js"></script>
    <style>
        .customer-name {
            max-width: 150px;
        }

        .customer-phone {
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }

        .payment {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .payment.cash {
            background: rgba(6, 214, 160, 0.1);
            color: #06d6a0;
            border: 1px solid rgba(6, 214, 160, 0.3);
        }

        .payment.banking {
            background: rgba(67, 97, 238, 0.1);
            color: #4361ee;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .payment.card {
            background: rgba(114, 9, 183, 0.1);
            color: #7209b7;
            border: 1px solid rgba(114, 9, 183, 0.3);
        }

        .status.shipping {
            background: rgba(255, 158, 0, 0.1);
            color: #ff9e00;
            border: 1px solid rgba(255, 158, 0, 0.3);
        }

        .order-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .order-stat-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .order-stat-item .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #4361ee;
            margin-bottom: 5px;
        }

        .order-stat-item .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
        }

        .urgent-orders {
            max-height: 300px;
            overflow-y: auto;
        }

        .urgent-order-item {
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            margin-bottom: 10px;
            background: rgba(255, 158, 0, 0.05);
        }

        .urgent-order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .urgent-order-header .order-id {
            font-weight: 600;
            color: #4361ee;
        }

        .urgent-order-header .order-time {
            font-size: 12px;
            color: #6c757d;
        }

        .urgent-order-body {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .urgent-order-body .customer {
            font-weight: 500;
        }

        .urgent-order-body .amount {
            font-weight: 600;
            color: #4361ee;
        }

        .urgent-order-actions {
            display: flex;
            gap: 10px;
        }

        .product-search {
            position: relative;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
        }

        .search-result-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #dee2e6;
            transition: all 0.3s ease;
        }

        .search-result-item:hover {
            background: #f0f3ff;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .result-name {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .result-price {
            font-size: 12px;
            color: #4361ee;
        }

        .order-items-table {
            width: 100%;
            border-collapse: collapse;
        }

        .order-items-table th,
        .order-items-table td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            text-align: center;
        }

        .order-items-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .order-items-table tfoot td {
            border-bottom: none;
            font-weight: 600;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .qty-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qty-btn:hover {
            background: #f8f9fa;
        }

        .quantity-control input {
            width: 50px;
            text-align: center;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 5px;
        }

        .order-detail {
            padding: 10px;
        }

        .order-items-detail {
            width: 100%;
            border-collapse: collapse;
        }

        .order-items-detail th,
        .order-items-detail td {
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            text-align: left;
        }

        .order-items-detail th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .detail-table {
            width: 100%;
        }

        .detail-table td {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .detail-table td:first-child {
            width: 120px;
            font-weight: 600;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h5 {
            margin-bottom: 15px;
            color: #4361ee;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .detail-section h5 i {
            color: #4361ee;
        }

        /* 1. CẤU HÌNH CHUNG CHO THẺ (PAYMENT & STATUS) */
        .payment,
        .status {
            /* Kích thước cố định để bằng nhau */
            display: inline-block;
            width: 110px;
            /* Độ rộng cố định (đủ cho chữ dài nhất) */
            text-align: center;
            /* Căn giữa chữ */

            /* Giao diện chung */
            padding: 6px 0;
            /* Padding trên dưới */
            border-radius: 20px;
            /* Bo tròn */
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            /* Không cho xuống dòng */
        }

        /* 2. MÀU SẮC CHO PHƯƠNG THỨC THANH TOÁN */
        .payment.cash {
            background: rgba(6, 214, 160, 0.1);
            color: #06d6a0;
            border: 1px solid rgba(6, 214, 160, 0.3);
        }

        .payment.banking {
            background: rgba(67, 97, 238, 0.1);
            color: #4361ee;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .payment.card {
            background: rgba(114, 9, 183, 0.1);
            color: #7209b7;
            border: 1px solid rgba(114, 9, 183, 0.3);
            /* Nếu muốn bỏ vạch tím bên trái thì xóa dòng border-left ở code cũ đi */
        }

        /* 3. MÀU SẮC CHO TRẠNG THÁI ĐƠN HÀNG */
        .status.pending {
            /* Chờ xử lý - Màu vàng */
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status.shipping {
            /* Đang giao - Màu cam */
            background: rgba(255, 158, 0, 0.1);
            color: #ff9e00;
            border: 1px solid rgba(255, 158, 0, 0.3);
        }

        .status.completed {
            /* Hoàn thành - Màu xanh dương */
            background: rgba(67, 97, 238, 0.1);
            color: #4361ee;
            border: 1px solid rgba(67, 97, 238, 0.3);
        }

        .status.cancelled {
            /* Đã hủy - Màu xám */
            background: rgba(108, 117, 125, 0.1);
            color: #6c757d;
            border: 1px solid rgba(108, 117, 125, 0.3);
        }

        .status.processing {
            /* Đang xử lý - Màu xanh lá */
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .order-items-table th,
        .order-items-detail th {
            background-color: #e9ecef !important;
            /* Nền màu xám rõ hơn chút */
            color: #111111 !important;
            /* Chữ màu đen tuyệt đối */
            font-weight: 600;
            text-transform: uppercase;
            /* Chữ in hoa cho đẹp */
            border-bottom: 2px solid #ced4da;
            /* Viền dưới đậm hơn */
        }

        /* Đảm bảo phần nội dung (dòng bên dưới) cũng có chữ màu đen */
        .order-items-table td,
        .order-items-detail td {
            color: #333333 !important;
            background-color: #ffffff !important;
            /* Nền trắng cho nội dung */
        }

        /* --- CSS CHO KHUNG TÌM KIẾM CÓ THANH CUỘN --- */
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;

            /* QUAN TRỌNG: Tạo thanh cuộn */
            max-height: 300px;
            /* Chiều cao tối đa (khoảng 5-6 sản phẩm) */
            overflow-y: auto;
            /* Tự động hiện thanh cuộn dọc nếu dài hơn 300px */
        }

        /* Tùy chỉnh thanh cuộn cho đẹp (Webkit browsers: Chrome, Safari) */
        .search-results::-webkit-scrollbar {
            width: 6px;
        }

        .search-results::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .search-results::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .search-results::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
    <script>
        // Hàm đăng xuất
        function logout() {
            localStorage.clear(); // Xóa sạch token và info
            window.location.href = "/login";
        }
    
        document.addEventListener("DOMContentLoaded", function() {
            // 1. Lấy thông tin từ LocalStorage
            const role = localStorage.getItem("userRole");
            const username = localStorage.getItem("username");
    
            // 2. Hiển thị tên người dùng vào Sidebar
            if (username) {
                document.getElementById("current-username").innerText = username;
            }
    
            // 3. Xử lý phân quyền hiển thị (Ẩn menu nếu không phải Admin)
            // Lưu ý: role 1 là Admin (theo file roles.js của bạn)
            if (role != "1") {
                // Đổi chức vụ hiển thị
                document.getElementById("current-role-name").innerText = "Nhân viên";
    
                // Tìm và ẩn các mục có class 'admin-only'
                const adminElements = document.querySelectorAll('.admin-only');
                adminElements.forEach(function(el) {
                    el.style.display = 'none';
                });
                
                // Chặn truy cập trang Dashboard nếu lỡ vào
                if (window.location.pathname.includes("TongQuanHeThong")) {
                     window.location.href = "/QLDonHang";
                }
            } else {
                 document.getElementById("current-role-name").innerText = "Quản trị viên";
            }
        });
    </script>
</body>
</html>